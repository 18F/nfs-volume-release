---
<%
  database_host = nil
  if_p('nfsbrokerpush.db.host') do |host|
    database_host = host
  end.else do
    database_host = link('database').instances[0].address
  end

  allowed_options = 'uid,gid,auto_cache,version'
  if p('nfsbrokerpush.ldap_enabled')
    allowed_options = 'auto_cache,username,password,version'
  end
  if p('nfsbrokerpush.ldap_test_mode')
    allowed_options = 'auto_cache,uid,gid,username,password,version'
  end
%>
  buildpack: binary_buildpack
  domain: "<%= p('nfsbrokerpush.app_domain') %>"
  memory: "<%= p('nfsbrokerpush.memory_in_mb') %>M"
  env:
    GOPACKAGENAME: nfsbroker
    GOVERSION: go1.7
    SERVICENAME: "<%= p('nfsbrokerpush.service_name') %>"
    USERNAME: "<%= p('nfsbrokerpush.username') %>"
    PASSWORD: "<%= p('nfsbrokerpush.password') %>"
    LOGLEVEL: info
    DBDRIVERNAME: "<%= p('nfsbrokerpush.db.driver') %>"
    DBHOST: "<%= database_host %>"
    DBPORT: "<%= p('nfsbrokerpush.db.port') %>"
    DBNAME: "<%= p('nfsbrokerpush.db.name') %>"
<% if p('nfsbrokerpush.ldap_test_mode') %>
    DBCACERT: |
      <%= p("nfsbrokerpush.db.ca_cert") %>
<% else %>
    DBCACERT: ""
<% end %>
    DB_USERNAME: "<%= p('nfsbrokerpush.db.username') %>"
    DB_PASSWORD: "<%= p('nfsbrokerpush.db.password') %>"
    ALLOWED_OPTIONS: "<%= allowed_options %>"
